/*jshint esversion: 6 */
/*jshint -W007*/
var dataObject = [{
    "id": 272822514,
    "firstName": "Billy",
    "lastName": "Bob",
    "gender": "male",
    "dob": "1/18/1949",
    "height": 71,
    "weight": 175,
    "eyeColor": "brown",
    "occupation": "programmer",
    "parents": [],
    "currentSpouse": 401222887
}, {
    "id": 401222887,
    "firstName": "Uma",
    "lastName": "Bob",
    "gender": "female",
    "dob": "4/1/1947",
    "height": 65,
    "weight": 162,
    "eyeColor": "brown",
    "occupation": "assistant",
    "parents": [],
    "currentSpouse": 272822514
}, {
    "id": 409574486,
    "firstName": "Michael",
    "lastName": "Walkens",
    "gender": "male",
    "dob": "5/9/1951",
    "height": 76,
    "weight": 250,
    "eyeColor": "brown",
    "occupation": "landscaper",
    "parents": [],
    "currentSpouse": 260451248
}, {
    "id": 260451248,
    "firstName": "Jon",
    "lastName": "Walkens",
    "gender": "male",
    "dob": "9/6/1945",
    "height": 62,
    "weight": 115,
    "eyeColor": "brown",
    "occupation": "assistant",
    "parents": [],
    "currentSpouse": 409574486
}, {
    "id": 629807187,
    "firstName": "Jack",
    "lastName": "Pafoy",
    "gender": "male",
    "dob": "3/16/1938",
    "height": 70,
    "weight": 207,
    "eyeColor": "black",
    "occupation": "nurse",
    "parents": [],
    "currentSpouse": 464142841
}, {
    "id": 464142841,
    "firstName": "Jen",
    "lastName": "Pafoy",
    "gender": "female",
    "dob": "4/10/1940",
    "height": 72,
    "weight": 256,
    "eyeColor": "black",
    "occupation": "student",
    "parents": [],
    "currentSpouse": 629807187
}, {
    "id": 982411429,
    "firstName": "Mister",
    "lastName": "Potatoo",
    "gender": "male",
    "dob": "12/18/1952",
    "height": 66,
    "weight": 170,
    "eyeColor": "hazel",
    "occupation": "architect",
    "parents": [],
    "currentSpouse": 595767575
}, {
    "id": 595767575,
    "firstName": "Missuz",
    "lastName": "Potatoo",
    "gender": "female",
    "dob": "10/28/1948",
    "height": 59,
    "weight": 137,
    "eyeColor": "blue",
    "occupation": "architect",
    "parents": [],
    "currentSpouse": 982411429
}, {
    "id": 693243224,
    "firstName": "Joy",
    "lastName": "Madden",
    "gender": "female",
    "dob": "4/20/1939",
    "height": 69,
    "weight": 199,
    "eyeColor": "hazel",
    "occupation": "doctor",
    "parents": [],
    "currentSpouse": null
}, {
    "id": 888201200,
    "firstName": "Mader",
    "lastName": "Madden",
    "gender": "male",
    "dob": "5/6/1937",
    "height": 76,
    "weight": 205,
    "eyeColor": "black",
    "occupation": "landscaper",
    "parents": [],
    "currentSpouse": null
}, {
    "id": 878013758,
    "firstName": "Jill",
    "lastName": "Pafoy",
    "gender": "Bob",
    "dob": "2/8/1972",
    "height": 74,
    "weight": 118,
    "eyeColor": "brown",
    "occupation": "programmer",
    "parents": [401222887],
    "currentSpouse": 294874671
}, {
    "id": 951747547,
    "firstName": "Ralph",
    "lastName": "Bob",
    "gender": "male",
    "dob": "12/23/1969",
    "height": 66,
    "weight": 179,
    "eyeColor": "blue",
    "occupation": "nurse",
    "parents": [401222887],
    "currentSpouse": 159819275
}, {
    "id": 159819275,
    "firstName": "Jasmine",
    "lastName": "Bob",
    "gender": "female",
    "dob": "12/18/1969",
    "height": 58,
    "weight": 156,
    "eyeColor": "blue",
    "occupation": "assistant",
    "parents": [409574486, 260451248],
    "currentSpouse": 951747547
}, {
    "id": 348457184,
    "firstName": "Annie",
    "lastName": "Pafoy",
    "gender": "female",
    "dob": "11/4/1970",
    "height": 62,
    "weight": 235,
    "eyeColor": "hazel",
    "occupation": "landscaper",
    "parents": [629807187, 464142841],
    "currentSpouse": null
}, {
    "id": 294874671,
    "firstName": "Dave",
    "lastName": "Pafoy",
    "gender": "male",
    "dob": "8/5/1967",
    "height": 61,
    "weight": 112,
    "eyeColor": "green",
    "occupation": "doctor",
    "parents": [629807187, 464142841],
    "currentSpouse": 878013758
}, {
    "id": 931247228,
    "firstName": "Amii",
    "lastName": "Pafoy",
    "gender": "female",
    "dob": "3/13/1963",
    "height": 74,
    "weight": 184,
    "eyeColor": "brown",
    "occupation": "landscaper",
    "parents": [629807187, 464142841],
    "currentSpouse": null
}, {
    "id": 822843554,
    "firstName": "Regina",
    "lastName": "Madden",
    "gender": "female",
    "dob": "7/26/1959",
    "height": 71,
    "weight": 249,
    "eyeColor": "brown",
    "occupation": "nurse",
    "parents": [693243224, 888201200],
    "currentSpouse": null
}, {
    "id": 819168108,
    "firstName": "Hana",
    "lastName": "Madden",
    "gender": "female",
    "dob": "10/7/1953",
    "height": 70,
    "weight": 187,
    "eyeColor": "brown",
    "occupation": "politician",
    "parents": [693243224, 888201200],
    "currentSpouse": null
}, {
    "id": 969837479,
    "firstName": "Eloise",
    "lastName": "Madden",
    "gender": "female",
    "dob": "12/11/1961",
    "height": 63,
    "weight": 241,
    "eyeColor": "brown",
    "occupation": "assistant",
    "parents": [693243224, 888201200],
    "currentSpouse": null
}, {
    "id": 313207561,
    "firstName": "Mattias",
    "lastName": "Madden",
    "gender": "male",
    "dob": "2/19/1966",
    "height": 70,
    "weight": 110,
    "eyeColor": "blue",
    "occupation": "assistant",
    "parents": [693243224, 888201200],
    "currentSpouse": 313997561
}, {
    "id": 313997561,
    "firstName": "Ellen",
    "lastName": "Madden",
    "gender": "female",
    "dob": "2/19/1970",
    "height": 67,
    "weight": 100,
    "eyeColor": "blue",
    "occupation": "doctor",
    "parents": [],
    "currentSpouse": 313207561
}, {
    "id": 313998000,
    "firstName": "Joey",
    "lastName": "Madden",
    "gender": "female",
    "dob": "2/02/1987",
    "height": 67,
    "weight": 100,
    "eyeColor": "blue",
    "occupation": "doctor",
    "parents": [313207561, 313997561],
    "currentSpouse": null
}];
const start = () => {
    let inputNumber = prompt("SELECT A NUMBER\n1. Search by first and last name.\n2. Search by characteristics of the person.\n3. Exit");
    let objects = dataObject;
    switch (inputNumber) {
    case "1":
        let name = prompt("Enter a first and last name to search.")
            .split(" ");
        let person = matchingFirstName(name[0], matchingLastName(name[1], objects, isMatch), isMatch);
        getUserSelection(person[0], objects, responder, getDetails, getDescendants, getFamily, getFirstNextOfKin, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, getRelatives, isNotObject, excludeMatchingObjects, getFamily, getDetails, sortByAge);
        break;
    case "2":
        let traits = [];
        let results = objects;
        alert("Please type what you know about the person.\n");
        let input = prompt('Enter a gender.');
        if (input !== "") {
            results = matchingGender(input.toLowerCase(), results, isMatch);
        }
        input = prompt('Enter an age or age range (#-#)');
        if (!isNaN(input) && input !== "") {
            results = results.filter(o => matchingAge(o, input.split('-'), getAge));
        }
        let height = prompt('Enter a height #\'#"');
        if (height !== "") {
            input = convertHeightToInches(height);
            results = matchingHeight(input, results, isMatch);
        }
        input = prompt('Enter a weight in pounds.');
        if (input !== "") {
            result = checkInput(input, isNaN, results, isMatch, matchingAge, 'Please enter a valid weight in pounds');
        }
        input = prompt('Enter an eye color.');
        if (input !== "") {
            results = matchingEyeColor(input.toLowerCase(), results, isMatch);
        }
        input = prompt('Enter an occupation.');
        if (input !== "") {
            results = matchingOccupation(input.toLowerCase(), results, isMatch);
        }
        responder(getDetails(results, 'Results', []));
        start();
        break;
    case "3":
        alert("You have exited the most-wanted search.");
        break;
    default:
        alert("Invalid Selection!");
        start();
        break;
    }
};
const checkInput = (input, condition, previousResults, isMatch, matchingFunction, reprompt) => {
    if (condition(input)) {
        checkInput(prompt(reprompt), condition, previousResults, isMatch, matchingFunction, reprompt);
    }
    return matchingFunction(input, previousResults, isMatch);
};
const getUserSelection = (object, objects, responder, getDetails, getDescendants, getFamily, getFirstNextOfKin, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, getRelatives, isNotObject, excludeMatchingObjects, getFamily, getDetails, sortByAge) => {
    let details;
    let inputNumber = prompt("SELECT A NUMBER:\r\n1. Find Descendants\r\n2. Find Immediate Family\r\n3. Find Next of Kin");
    switch (inputNumber) {
    case '1':
        let descendants = getDescendants(object, objects, isChildren, matchingChildren);
        details = getDetails(descendants, 'Descendants', []);
        responder(details);
        break;
    case '2':
        let family = getFamily(object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, isNotObject, excludeMatchingObjects);
        details = getDetails(family.spouse, 'Spouse', []);
        details += getDetails(family.children, 'Children', []);
        details += getDetails(family.parents, 'Parents', []);
        details += getDetails(family.siblings, 'Siblings', []);
        responder(details);
        break;
    case '3':
        details = getFirstNextOfKin(object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, getRelatives, isNotObject, excludeMatchingObjects, getFamily, getDetails, sortByAge);
        responder(details);
        break;
    default:
        alert("Invalid Selection!");
        break;
    }
    start();
};
const responder = (object) => alert(object);
const isMatch = (element, object) => object == element;
const matchingGender = (element, objects, isMatch) =>
    objects.filter(object => isMatch(element, object.gender));
const matchingAge = (element, ageRange, getAge) => {
    let controlledAge = getAge(element.dob);
    if (ageRange.length === 1) {
        return (controlledAge) == ageRange[0];
    }
    return controlledAge >= ageRange[0] && controlledAge <= ageRange[1];
};
const getAge = (ageString) => {
    let controlledAge = Date.parse(ageString);
    let msInYear = 31556952000;
    let negativeFix = Date.now();
    return parseInt(((negativeFix - controlledAge) / msInYear));
};
const matchingHeight = (element, objects, isMatch) =>
    objects.filter(object => isMatch(element, object.height));
const matchingWeight = (element, objects, isMatch) =>
    objects.filter(object => isMatch(element, object.weight));
const matchingEyeColor = (element, objects, isMatch) =>
    objects.filter(object => isMatch(element, object.eyeColor));
const matchingOccupation = (element, objects, isMatch) =>
    objects.filter(object => isMatch(element, object.occupation));
const matchingLastName = (element, objects, isMatch) =>
    objects.filter(o => isMatch(element, o.lastName));
const matchingFirstName = (element, objects, isMatch) =>
    objects.filter(o => isMatch(element, o.firstName));
const getParents = (object, objects, parents = []) => {
    object.parents.forEach(p => parents.push(...objects.filter(o => p === o.id)));
    return parents;
};
const isParent = (element, indexOfElement, parents, indexOfParent) =>
    element[indexOfElement] === parents[indexOfParent];
const matchingParents = (parents, objects, isParent) => {
    if (parents.length <= 0)
        return [];
    if (parents.length == 1)
        return objects.filter(object => isParent(object.parents, parents, 0, 0));
    return objects.filter(object =>
        isParent(object.parents, 0, parents, 0) ||
        isParent(object.parents, 0, parents, 1) ||
        isParent(object.parents, 1, parents, 0) ||
        isParent(object.parents, 1, parents, 1));
};
const matchingSpouse = (element, objects, isMatch) =>
    objects.filter(object => isMatch(element.currentSpouse, object.id));
const isChildren = (element, object) =>
    object.parents[0] === element.id ||
    object.parents[1] === element.id;
const matchingChildren = (element, objects, isChildren) =>
    objects.filter(object => isChildren(element, object));
const isNotObject = (element, object) => object !== element;
const excludeMatchingObjects = (element, objects, isNotObject) =>
    objects.filter(object => isNotObject(element, object));
const getDescendants =
    (object, objects, isChildren, matchingChildren, allDescendants = []) => {
        if (object === undefined) return [];
        let children = matchingChildren(object, objects, isChildren);
        if (children.length <= 0)
            return [];
        children.forEach(child => allDescendants.push(child));
        children.forEach(child => getDescendants(child, objects, isChildren, matchingChildren, allDescendants));
        return allDescendants;
    };
const getFamily =
    (object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, isNotObject, excludeMatchingObjects, allFamilyMembers = []) => {
        if (object === undefined) return [];
        allFamilyMembers.spouse = matchingSpouse(object, objects, isMatch);
        allFamilyMembers.children = matchingChildren(object, objects, isChildren);
        allFamilyMembers.parents = getParents(object, objects);
        allFamilyMembers.siblings = matchingParents(allFamilyMembers.parents.map(o => o.id), excludeMatchingObjects(object, objects, isNotObject), isParent);
        return allFamilyMembers;
    };
const getNextOfKinList =
    (object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, getRelatives, isNotObject, excludeMatchingObjects, getFamily, nextOfKin = []) => {
        if (object === undefined) return [];
        let family = getFamily(object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, isNotObject, excludeMatchingObjects);
        nextOfKin.spouse = family.spouse;
        nextOfKin.children = family.children;
        nextOfKin.parents = family.parents;
        nextOfKin.siblings = family.siblings;
        nextOfKin.grandChildren = getRelatives(nextOfKin.children, objects, isChildren);
        nextOfKin.grandParents = [];
        nextOfKin.parents.forEach(object => nextOfKin.grandParents.push(...getParents(object, objects)));
        nextOfKin.siblingsChildren = getRelatives(nextOfKin.siblings, objects, isChildren);
        nextOfKin.parentsSiblings = matchingParents(nextOfKin.grandParents.map(o => o.id), excludeMatchingObjects(nextOfKin.parents, objects, isNotObject), isParent);
        nextOfKin.greatGrandchildren = getRelatives(nextOfKin.grandChildren, objects, isChildren);
        nextOfKin.greatGrandparents = [];
        nextOfKin.grandParents.forEach(object => nextOfKin.greatGrandparents.push(...getParents(object, objects)));
        return nextOfKin;
    };
const getRelatives =
    (object, objects, association, relatives = []) => {
        if (object.length <= 0) return [];
        object.forEach(object =>
            relatives.push(...objects.filter(o => association(object, o))));
        return relatives;
    };
const sortByAge = (personArray, eldest = []) => {
    if (personArray === undefined || personArray.length <= 0) return [];
    let results = personArray.sort((a, b) => Date.parse(a.dob) - Date.parse(b.dob));
    eldest.push(results[0]);
    return eldest;
};
const convertHeightToInches = (height) => {
    let inchesInFoot = 12;
    let heightArray = height.replace(/[^\d]/g, ' ')
        .split(' ', 2);
    return (+(heightArray[0] * inchesInFoot) + +heightArray[1]);

};
const getDetails = (people, label, keys) => {
    let string = label + ":\n";
    if (people === undefined) return string;
    people.forEach(person => {
        string += '   ' + person.firstName + " " + person.lastName + "\n";
        keys.forEach(o => string += o + ": " + person[o] + "\n");
    });
    return string;
};
const getFirstNextOfKin = (object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, getRelatives, isNotObject, excludeMatchingObjects, getFamily, getDetails, sortByAge) => {
    let nextOfKin = getNextOfKinList(object, objects, getParents, isMatch, isParent, matchingParents, matchingSpouse, isChildren, matchingChildren, getRelatives, isNotObject, excludeMatchingObjects, getFamily);
    if (nextOfKin.spouse.length > 0) return getDetails(nextOfKin.spouse, 'Spouse', []);
    if (nextOfKin.spouse.length <= 0 && nextOfKin.children.length > 0) return getDetails(sortByAge(nextOfKin.children), 'Child', []);
    if (nextOfKin.children.length <= 0 && nextOfKin.parents.length > 0) return getDetails(sortByAge(nextOfKin.parents), 'Parent', []);
    if (nextOfKin.parents.length <= 0 && nextOfKin.siblings.length > 0) return getDetails(sortByAge(nextOfKin.siblings), 'Sibling', []);
    if (nextOfKin.siblings.length <= 0 && nextOfKin.grandChildren.length > 0) return getDetails(sortByAge(nextOfKin.grandChildren), 'Grand Child', []);
    if (nextOfKin.grandChildren.length <= 0 && nextOfKin.grandParents.length > 0) return getDetails(sortByAge(nextOfKin.grandParents), 'Grand Parent', []);
    if (nextOfKin.grandParents.length <= 0 && nextOfKin.siblingsChildren.length > 0) return getDetails(sortByAge(nextOfKin.siblingsChildren), 'Niece/Nephew', []);
    if (nextOfKin.siblingsChildren.length <= 0 && nextOfKin.parentsSiblings) return getDetails(sortByAge(nextOfKin.parentsSiblings), 'Aunt/Uncle', []);
    if (nextOfKin.parentsSiblings.length <= 0 && nextOfKin.greatGrandchildren) return getDetails(sortByAge(nextOfKin.greatGrandchildren), 'Great Grandchild', []);
    if (nextOfKin.greatGrandchildrendetails <= 0 && nextOfKin.greatGrandparents) return getDetails(sortByAge(nextOfKin.greatGrandparents), 'Great Grandparent', []);
    return 'No living next of kin.';
};
